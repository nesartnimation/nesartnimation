<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Producto - NesArt</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="portfolio">

<!-- HEADER Y MENÃš -->
<header id="main-header">
  <div class="logo-container">
    <img src="images/LogoNesArt.png" alt="Logo NesArt" class="logo">
  </div>
  <nav id="main-menu">
    <ul>
      <li><a href="Nesart.html">Nesart</a></li>
      <li><a href="Comisiones.html">Comisiones</a></li>
      <li><a href="Originales.html">Originales</a></li>
      <li><a href="Tienda.html">Tienda</a></li>
      <li><a href="Contacto.html">Contacto</a></li>
    </ul>
  </nav>

  <!-- CARRITO FLOTE -->
  <div id="cart">
    <span id="cart-count">0</span> ðŸ›’
  </div>
</header>

<!-- MODAL CARRITO -->
<div id="cart-modal">
  <div id="cart-modal-content">
    <button id="cart-modal-close">Ã—</button>
    <h2>Carrito</h2>
    <ul id="cart-modal-items"></ul>
    <p id="cart-modal-empty">Tu carrito estÃ¡ vacÃ­o</p>
    <p id="cart-modal-total"></p>
    <button id="cart-modal-checkout" class="checkout-button">Ir al checkout</button>
  </div>
</div>

<!-- PRODUCTO -->
<main style="padding-top: 180px;">
  <section class="product-page">
    <!-- IZQUIERDA: INFO DEL PRODUCTO -->
    <div class="product-info">
      <h1 id="product-title">Producto</h1>
      <p id="product-description">DescripciÃ³n del producto...</p>
      <p id="product-price">Precio: 0â‚¬</p>
      <p id="product-stock">Stock: 0</p>
      <button id="product-add-btn">AÃ±adir al carrito</button>
    </div>

    <!-- DERECHA: IMAGEN -->
    <div class="product-image">
      <img id="product-img" src="" alt="Producto">
    </div>
  </section>
</main>

<!-- SCRIPT PRODUCTO -->
<script>
  // =======================
  // VARIABLES MODAL CARRITO
  // =======================
  const cartButton = document.getElementById('cart');
  const cartModal = document.getElementById('cart-modal');
  const cartModalClose = document.getElementById('cart-modal-close');
  const cartModalItems = document.getElementById('cart-modal-items');
  const cartModalEmpty = document.getElementById('cart-modal-empty');
  const cartModalTotal = document.getElementById('cart-modal-total');
  const cartModalCheckout = document.getElementById('cart-modal-checkout');
  const cartCount = document.getElementById('cart-count');

  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // =======================
  // FUNCIONES CARRITO / MODAL
  // =======================
  function updateCart() {
    cartCount.textContent = cart.reduce((sum,item)=>sum+item.quantity,0);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCartModal();
  }

  function renderCartModal() {
    cartModalItems.innerHTML = '';
    if(cart.length === 0){
      cartModalEmpty.style.display = 'block';
      cartModalTotal.textContent = '';
    } else {
      cartModalEmpty.style.display = 'none';
      let total = 0;
      cart.forEach((item,index)=>{
        const li = document.createElement('li');
        li.textContent = `${item.name} - ${item.price}â‚¬ x ${item.quantity}`;
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'âŒ';
        removeBtn.addEventListener('click', ()=>{
          cart.splice(index,1);
          updateCart();
        });
        li.appendChild(removeBtn);
        cartModalItems.appendChild(li);
        total += item.price*item.quantity;
      });
      cartModalTotal.textContent = `Total: ${total}â‚¬`;
    }
  }

  function openCartModal(){ cartModal.classList.add('active'); renderCartModal(); }
  function closeCartModal(){ cartModal.classList.remove('active'); }

  if(cartButton){ cartButton.addEventListener('click', openCartModal); }
  if(cartModalClose){ cartModalClose.addEventListener('click', closeCartModal); }
  if(cartModalCheckout){
    cartModalCheckout.addEventListener('click', ()=>{
      if(cart.length===0){ alert("TodavÃ­a no has puesto nada en tu carrito"); }
      else { window.location.href='checkout.html'; }
    });
  }

  updateCart();

  // =======================
  // CARGAR PRODUCTO
  // =======================
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get('id');

  const titleEl = document.getElementById('product-title');
  const imgEl = document.getElementById('product-img');
  const priceEl = document.getElementById('product-price');
  const descEl = document.getElementById('product-description');
  const stockEl = document.getElementById('product-stock');
  const addBtn = document.getElementById('product-add-btn');

  fetch('data/products.json')
    .then(res=>res.json())
    .then(products=>{
      const product = products.find(p=>p.id === productId);
      if(!product){
        titleEl.textContent = "Producto no encontrado";
        return;
      }

      titleEl.textContent = product.name;
      imgEl.src = product.image;
      imgEl.alt = product.name;
      priceEl.textContent = `Precio: ${product.price}â‚¬`;
      descEl.textContent = product.description || "DescripciÃ³n pendiente";
      stockEl.textContent = `Stock: ${product.stock || 'âˆž'}`;

      addBtn.addEventListener('click', ()=>{
        const existing = cart.find(item=>item.id===product.id);
        if(existing) existing.quantity +=1;
        else cart.push({id:product.id,name:product.name,price:product.price,quantity:1});
        updateCart();
        openCartModal();
      });
    })
    .catch(err=>{
      console.error(err);
      titleEl.textContent = "Error cargando producto";
    });
</script>

</body>
</html>
