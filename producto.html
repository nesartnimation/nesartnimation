<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Producto - NesArt</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body class="portfolio producto">

<header id="main-header">
  <div class="logo-container">
    <a href="Tienda.html">
      <img src="images/LogoNesArt.png" alt="Logo NesArt" class="logo">
    </a>
  </div>

  <nav id="main-menu">
    <ul>
      <li><a href="Nesart.html">Nesart</a></li>
      <li><a href="Comisiones.html">Comisiones</a></li>
      <li><a href="Originales.html">Originales</a></li>
      <li><a href="Tienda.html">Tienda</a></li>
      <li><a href="Contacto.html">Contacto</a></li>
    </ul>
  </nav>

  <div id="cart">
    <span id="cart-count">0</span> ðŸ›’
  </div>
</header>

<main style="padding-top:180px;">
  <section class="product-page">

    <div class="product-info">
      <h1 id="product-title"></h1>
      <p id="product-description"></p>
      <p id="product-price"></p>
      <p id="product-stock"></p>
      <button id="product-add-btn">AÃ±adir al carrito</button>
    </div>

    <div class="product-image">
      <img id="product-img" alt="">
    </div>

  </section>
</main>

<!-- MODAL CARRITO -->
<div id="cart-modal" class="cart-modal">
  <div class="cart-modal-content">
    <span class="cart-close">&times;</span>
    <h2>Tu carrito</h2>
    <ul id="cart-modal-items"></ul>
    <p id="cart-modal-total"></p>
    <button id="cart-modal-checkout">Finalizar compra</button>
    <p id="cart-modal-empty">Tu carrito estÃ¡ vacÃ­o</p>
  </div>
</div>

  <!-- MODAL CHECKOUT -->
<div id="checkout-modal" class="cart-modal">
  <div class="cart-modal-content">
    <span class="checkout-close">&times;</span>
    <h2>Finalizar Compra</h2>

    <div class="checkout-container" style="display:flex; gap:20px; flex-wrap:wrap;">
      
      <!-- COLUMNA IZQUIERDA: RESUMEN DE COMPRA -->
      <div class="checkout-left" style="flex:1; min-width:300px;">
        <h3>Resumen de tu compra</h3>
        <ul id="checkout-cart-items" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px;"></ul>

        <div class="checkout-prices" style="margin-top:15px;">
          <p id="checkout-subtotal">Subtotal: 0â‚¬</p>
          <p id="checkout-vat">IVA 21%: 0â‚¬</p>
          <p id="checkout-shipping">EnvÃ­o: 6â‚¬</p>
          <p id="checkout-total" style="font-weight:bold;">Total: 0â‚¬</p>
        </div>
      </div>

      <!-- COLUMNA DERECHA: DATOS DEL CLIENTE -->
      <div class="checkout-right" style="flex:1; min-width:300px;">
        <h3>Datos del Cliente</h3>
        <input type="text" id="client-name" placeholder="Nombre" required>
        <input type="email" id="client-email" placeholder="Email" required>
        <input type="tel" id="client-phone" placeholder="NÃºmero de telÃ©fono" required>
        <input type="text" id="client-address" placeholder="DirecciÃ³n" required>
        <input type="text" id="client-postal" placeholder="CÃ³digo postal" required>
        <input type="text" id="client-country" placeholder="PaÃ­s" required>
        <input type="text" id="client-city" placeholder="Ciudad" required>
        <textarea id="client-message" placeholder="Mensaje (opcional)"></textarea>

        <h3>MÃ©todo de pago</h3>
        <label>
          <input type="radio" name="payment" value="card" checked> Tarjeta
        </label>
        <label>
          <input type="radio" name="payment" value="paypal"> PayPal
        </label>

        <button id="checkout-confirm-btn" style="margin-top:15px; background:#ff4d4f; color:white; border:none; padding:10px 15px; border-radius:6px; cursor:pointer;">Confirmar Compra</button>
      </div>

    </div>
  </div>
</div>


<script>
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

const titleEl = document.getElementById('product-title');
const imgEl = document.getElementById('product-img');
const priceEl = document.getElementById('product-price');
const descEl = document.getElementById('product-description');
const stockEl = document.getElementById('product-stock');
const addBtn = document.getElementById('product-add-btn');

fetch('data/products.json')
  .then(res => res.json())
  .then(products => {
    const product = products.find(p => p.id === productId);
    if (!product) {
      titleEl.textContent = 'Producto no encontrado';
      addBtn.style.display = 'none';
      return;
    }

    const stock = product.stock ?? Infinity;

    titleEl.textContent = product.name;
    imgEl.src = product.image;
    imgEl.alt = product.name;
    priceEl.textContent = `Precio: ${product.price}â‚¬`;
    descEl.textContent = product.description || '';
    stockEl.textContent = `Stock: ${stock === Infinity ? 'âˆž' : stock}`;

    if (stock === 0) {
      addBtn.disabled = true;
      addBtn.textContent = 'Sin stock';
    }

    addBtn.addEventListener('click', () => {
      const existing = cart.find(i => i.id === product.id);
      const currentQty = existing ? existing.quantity : 0;

      if (currentQty + 1 > stock) return;

      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          image: product.image,
          quantity: 1,
          stock: stock
        });
      }

      if (currentQty + 1 === stock) {
        addBtn.disabled = true;
        addBtn.textContent = 'Sin stock';
      }

      updateCart();
      cartModal.style.display = 'flex';
    });
  })
  .catch(err => {
    console.error(err);
    titleEl.textContent = 'Error cargando producto';
    addBtn.style.display = 'none';
  });
</script>

<script src="js/shop.js"></script>
</body>
</html>
