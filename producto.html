<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Producto - NesArt</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body class="portfolio producto">

<header id="main-header">
  <div class="logo-container">
    <a href="Tienda.html">
      <img src="images/LogoNesArt.png" alt="Logo NesArt" class="logo">
    </a>
  </div>

  <nav id="main-menu">
    <ul>
      <li><a href="Nesart.html">Nesart</a></li>
      <li><a href="Comisiones.html">Comisiones</a></li>
      <li><a href="Originales.html">Originales</a></li>
      <li><a href="Tienda.html">Tienda</a></li>
      <li><a href="Contacto.html">Contacto</a></li>
    </ul>
  </nav>

  <div id="cart">
    <span id="cart-count">0</span> ðŸ›’
  </div>
</header>

<main style="padding-top:180px;">
  <section class="product-page">

    <div class="product-info">
      <h1 id="product-title"></h1>
      <p id="product-description"></p>
      <p id="product-price"></p>
      <p id="product-stock"></p>
      <button id="product-add-btn">AÃ±adir al carrito</button>
    </div>

    <div class="product-image">
      <img id="product-img" alt="">
    </div>

  </section>
</main>

<!-- MODAL CARRITO -->
<div id="cart-modal" class="cart-modal">
  <div class="cart-modal-content">
    <span class="cart-close">&times;</span>
    <h2>Tu carrito</h2>
    <ul id="cart-modal-items"></ul>
    <p id="cart-modal-total"></p>
    <button id="cart-modal-checkout">Finalizar compra</button>
    <p id="cart-modal-empty">Tu carrito estÃ¡ vacÃ­o</p>
  </div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

const titleEl = document.getElementById('product-title');
const imgEl = document.getElementById('product-img');
const priceEl = document.getElementById('product-price');
const descEl = document.getElementById('product-description');
const stockEl = document.getElementById('product-stock');
const addBtn = document.getElementById('product-add-btn');

fetch('data/products.json')
  .then(res => res.json())
  .then(products => {
    const product = products.find(p => p.id === productId);
    if (!product) {
      titleEl.textContent = 'Producto no encontrado';
      addBtn.style.display = 'none';
      return;
    }

    const stock = product.stock ?? Infinity;

    titleEl.textContent = product.name;
    imgEl.src = product.image;
    imgEl.alt = product.name;
    priceEl.textContent = `Precio: ${product.price}â‚¬`;
    descEl.textContent = product.description || '';
    stockEl.textContent = `Stock: ${stock === Infinity ? 'âˆž' : stock}`;

    if (stock === 0) {
      addBtn.disabled = true;
      addBtn.textContent = 'Sin stock';
    }

    addBtn.addEventListener('click', () => {
      const existing = cart.find(i => i.id === product.id);
      const currentQty = existing ? existing.quantity : 0;

      if (currentQty + 1 > stock) return;

      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          image: product.image,
          quantity: 1,
          stock: stock
        });
      }

      if (currentQty + 1 === stock) {
        addBtn.disabled = true;
        addBtn.textContent = 'Sin stock';
      }

      updateCart();
      cartModal.style.display = 'flex';
    });
  })
  .catch(err => {
    console.error(err);
    titleEl.textContent = 'Error cargando producto';
    addBtn.style.display = 'none';
  });
</script>

<script src="js/shop.js"></script>
</body>
</html>
