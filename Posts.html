<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Post - NesArt</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .post-form { max-width: 600px; margin: 40px auto; display: flex; flex-direction: column; gap: 15px; }
    .post-form input, .post-form textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .tags-container { display: flex; flex-wrap: wrap; gap: 5px; }
    .tag-item { background: #eee; padding: 5px 10px; border-radius: 5px; display: inline-flex; align-items: center; }
    .tag-item button { margin-left: 5px; border: none; background: #c00; color: #fff; cursor: pointer; border-radius: 3px; }
  </style>
</head>
<body class="portfolio create-post">

<header id="main-header">
  <div class="logo-container">
    <a href="nesart.html"><img src="images/LogoNesArt.png" alt="Logo NesArt" class="logo"></a>
  </div>
  <nav id="main-menu">
    <ul>
      <li><a href="Nesart.html">Nesart</a></li>
      <li><a href="Comisiones.html">Comisiones</a></li>
      <li><a href="Originales.html">Originales</a></li>
      <li><a href="Tienda.html">Tienda</a></li>
      <li><a href="Blog.html">Blog</a></li>
      <li><a href="Contacto.html">Contacto</a></li>
    </ul>
  </nav>
</header>

<main>
  <form class="post-form" id="post-form">
    <h2>Crear nuevo post</h2>

    <input type="text" id="post-title" placeholder="Título del post" required>
    <textarea id="post-desc" placeholder="Descripción del post" rows="5" required></textarea>
    <input type="file" id="post-image" accept="image/*" required>

    <!-- Categorías -->
    <input type="text" id="post-categories" placeholder="Categorías (separadas por comas)">
    
    <!-- Etiquetas -->
    <input type="text" id="post-tags" placeholder="Etiquetas (separadas por comas)">

    <button type="submit">Guardar Post</button>
  </form>

  <div class="posts-preview" id="posts-preview"></div>
</main>

<script>
  const postForm = document.getElementById('post-form');
  const postsPreview = document.getElementById('posts-preview');

  let posts = JSON.parse(localStorage.getItem('posts')) || [];

  function renderPostsPreview() {
    postsPreview.innerHTML = '';
    posts.forEach((post, index) => {
      const div = document.createElement('div');
      div.style.border = '1px solid #ccc';
      div.style.padding = '10px';
      div.style.marginBottom = '10px';
      div.style.display = 'flex';
      div.style.alignItems = 'center';
      div.style.justifyContent = 'space-between';

      div.innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;">
          <img src="${post.image}" alt="${post.title}" style="width:80px;height:80px;object-fit:cover;border-radius:5px;">
          <div>
            <strong>${post.title}</strong><br>
            <small>${post.desc.substring(0,50)}...</small>
          </div>
        </div>
        <button data-index="${index}">Eliminar</button>
      `;

      div.querySelector('button').addEventListener('click', e => {
        const idx = e.target.dataset.index;
        posts.splice(idx, 1);
        localStorage.setItem('posts', JSON.stringify(posts));
        renderPostsPreview();
      });

      postsPreview.appendChild(div);
    });
  }

  renderPostsPreview();

  postForm.addEventListener('submit', async e => {
    e.preventDefault();

    const title = document.getElementById('post-title').value.trim();
    const desc = document.getElementById('post-desc').value.trim();
    const imgFile = document.getElementById('post-image').files[0];
    const categories = document.getElementById('post-categories').value
      .split(',').map(c => c.trim()).filter(c => c);
    const tags = document.getElementById('post-tags').value
      .split(',').map(t => t.trim()).filter(t => t);

    if (!title || !desc || !imgFile) {
      alert('Completa todos los campos obligatorios');
      return;
    }

    // Convertir imagen a base64
    const reader = new FileReader();
    reader.onload = function() {
      const image = reader.result;

      const id = posts.length; // ID simple incremental
      const post = { id, title, desc, image, categories, tags };

      posts.push(post);
      localStorage.setItem('posts', JSON.stringify(posts));

      renderPostsPreview();
      postForm.reset();
    };
    reader.readAsDataURL(imgFile);
  });
</script>

</body>
</html>
