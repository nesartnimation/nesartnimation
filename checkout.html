<!-- MODAL CHECKOUT -->
<div id="checkout-modal" class="cart-modal">
  <div class="cart-modal-content">
    <span class="checkout-close">&times;</span>
    <h2>Finalizar Compra</h2>

    <div class="checkout-container">

      <!-- COLUMNA IZQUIERDA: RESUMEN DE COMPRA -->
      <div class="checkout-left">
        <h3>Resumen de tu compra</h3>
        <ul id="checkout-cart-items"></ul>

        <div class="checkout-prices">
          <p id="checkout-subtotal">Subtotal: 0€</p>
          <p id="checkout-vat">IVA 21%: 0€</p>
          <p id="checkout-shipping">Envío: 6€</p>
          <p id="checkout-total"><strong>Total: 0€</strong></p>
        </div>
      </div>

      <!-- COLUMNA DERECHA: DATOS DEL CLIENTE -->
      <div class="checkout-right">
        <h3>Datos del Cliente</h3>
        <input type="text" id="client-name" placeholder="Nombre" required>
        <input type="email" id="client-email" placeholder="Email" required>
        <input type="tel" id="client-phone" placeholder="Número de teléfono" required>
        <input type="text" id="client-address" placeholder="Dirección" required>
        <input type="text" id="client-postal" placeholder="Código postal" required>
        <input type="text" id="client-country" placeholder="País" required>
        <input type="text" id="client-city" placeholder="Ciudad" required>
        <textarea id="client-message" placeholder="Mensaje (opcional)"></textarea>

        <!-- MÉTODOS DE PAGO -->
        <h3>Método de pago</h3>
        <div class="payment-methods">
          <button class="payment-btn active" data-method="card">
            <img src="images/creditcard.svg" alt="Tarjeta">
            <span>Tarjeta</span>
          </button>
          <button class="payment-btn" data-method="paypal">
            <img src="images/paypal.svg" alt="PayPal">
            <span>PayPal</span>
          </button>
        </div>

        <!-- BOTÓN FINALIZAR COMPRA -->
        <button id="checkout-confirm-btn">Confirmar Compra</button>
      </div>

    </div>
  </div>
</div>

<script>
  const checkoutCartItems = document.getElementById('checkout-cart-items');
  const checkoutSubtotalEl = document.getElementById('checkout-subtotal');
  const checkoutTotalEl = document.getElementById('checkout-total');
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Selección de método de pago
  let selectedPayment = 'card';
  const paymentBtns = document.querySelectorAll('.payment-btn');
  paymentBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      paymentBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedPayment = btn.dataset.method;
    });
  });

  function renderCheckout() {
    checkoutCartItems.innerHTML = '';
    if(cart.length === 0){
      checkoutSubtotalEl.textContent = '0€';
      checkoutTotalEl.textContent = 'Total: 0€';
      return;
    }

    let subtotal = 0;
    cart.forEach((item, index) => {
      const itemTotal = item.price * item.quantity;
      subtotal += itemTotal;

      const li = document.createElement('li');
      li.innerHTML = `
        <img src="${item.image}" style="width:60px;height:60px;object-fit:cover;border-radius:6px;">
        <span>${item.name} x ${item.quantity}</span>
        <span>${itemTotal.toFixed(2)}€</span>
      `;
      checkoutCartItems.appendChild(li);
    });

    checkoutSubtotalEl.textContent = `${subtotal.toFixed(2)}€`;
    checkoutTotalEl.textContent = `Total: ${(subtotal + 6).toFixed(2)}€`;
  }

  renderCheckout();

  const checkoutBtn = document.getElementById('checkout-confirm-btn');
  checkoutBtn.addEventListener('click', () => {
    if(cart.length === 0){
      alert('Tu carrito está vacío');
      return;
    }
    alert(`¡Compra realizada! Método de pago: ${selectedPayment}`);
    cart = [];
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCheckout();
  });
</script>
